# 마이크로 프론트엔드에서의 SPA 구성

## SPA 구성

 웹 어플리케이션이 하나의 HTML 페이지에서 동적으로 콘텐츠를 로드하는 방식이다. 페이지 이동시 전체 페이지가 새로고침 되는 방식이 아닌 필요한 콘텐츠만 갱신한다. MFA도 SPA처럼 동작한다.

## 장단점

### 👉🏻 장점

- 각 마이크로 프론트엔드 간의 독립적인 배포가 가능하다.
- 사용자 경험이 향상된다.
- 각 마이크로 프론트엔드가 다른 기술 스택을 사용할 수 있어 유연성이 좋다.

### 👉🏻 단점

- 초기 로드 시간과 부피가 크다.
- 사버 측에서 SPA 구성으로 렌더링하는 것은 어렵다. 따라서 정보가 많은 페이지에서는 SPA 패턴으로의 구성을 배제한다.

## 핵심 SPA Shell 구축하기

### 👉🏻 SPA Shell

 마이크로 프론트엔드를 로드하고 관리하는 역할을 한다. 각 MFA가 하나의 애플리케이션처럼 동작할 수 있게 한다.

### 👉🏻 Single-SPA

 여러 마이크로 프론트엔드를 하나의 SPA로 로드하고 관리하도록 하는 라이브러리이다. MFA의 생명주기를 관리한다.

### 👉🏻 의존성 공유

- 명시적 구성: 공유할 라이브러리들을 전역적으로 선언하여 사용한다.

    ```jsx
    module.exports={
     externals:{
      "react": "React",
      "react-dom": "ReactDOM",
      "react-router-dom": "ReactRouterDOM"
     }
    }
    ```

- 묵시적 구성: ES 모듈 시스템 사용하기 등
- import map 사용

    ```jsx
    <script type="importmap">
        {
          "imports": {
            "react": "https://cdn.skypack.dev/react",
            "react-dom": "https://cdn.skypack.dev/react-dom"
          }
        }
      </script>
    ```

- WMF(Webpack Module Federation) 사용

## SPA 마이크로 프런트엔드 통합하기

### 👉🏻 수명 주기 선언

- bootstrap: 애플리케이션의 초기 설정 및 로드
- mount: 컴포넌트를 마운트하고 렌더링
- unmount: 컴포넌트 제거
- unload: 프레임워크 특정 부분을 제거할 때 명시적으로 사용

## 마이크로 프론트엔드 사이의 통신패턴

### 👉🏻 이벤트 교환

 MFA 간에 이벤트를 기반으로 통신한다. “A” MFA에서 발생한 버튼 클릭 이벤트를 “B” MFA에서 수신해 동작을 수행한다. 가장 보편적으로는 DOM API를 이벤트 리스너를 통해 커스텀 이벤트를 추가하여 사용할 수 있다.

### 👉🏻 데이터 공유하기

 전역적으로 공유할 수 있는 상태나 데이터 저장소를 활용하여 MFA간에 데이터를 공유할 수 있다.

### 👉🏻 컴포넌트 확장하기

 확장 슬롯을 사용하여 MFA간에 컴포넌트를 확장 또는 수정할 수 있다. 확장 슬롯은 다른 컴포넌트를 구성할 수 있는 위치를 제공한다.

## 용어 정리

- **로더 스크립트 (Loader Script):** 마이크로 프론트엔드를 로드하고 초기화하는 스크립트. 이 스크립트는 MFE를 동적으로 로드하거나, 필요한 의존성을 미리 로드하는 역할을 합니다.
- **브로커 (Broker):** 마이크로 프론트엔드 간의 통신을 중개하는 시스템. 이벤트 버스나 데이터 공유 메커니즘을 제공하여 여러 MFE 간의 데이터를 전달합니다.
